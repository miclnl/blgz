<section class="post-comments">
{{ if .Site.DisqusShortname }}
  <div class='post'>
    {{ template "_internal/disqus.html" . }}
  </div>
{{ else if  .Site.Params.staticman.enabled }}
	{{- $entryId := .File.UniqueID -}}
	{{- $comments := index $.Site.Data.comments $entryId -}}
	  {{ if .Site.Data.comments }}
		{{ if $comments }}
		  {{ if gt (len $comments) 1  }}
			<h2>{{ len $comments  }} {{ i18n "moreComment" }}</h2>
		  {{ else }}
			<h2>{{ len $comments  }} {{ i18n "oneComment" }}</h2>
		  {{ end }}
		{{ else }}
		  <h2>{{ i18n "nothing_yet" }}</h2>
		{{ end }}
	  
		{{ $.Scratch.Set "hasComments" 0 }}
		{{ range $comments }}
		  {{ $.Scratch.Add "hasComments" 1 }}
		  {{ if not .reply_to }}
			{{ $.Scratch.Set "parentId" ._id }}
			{{ $.Scratch.Set "parentName" .name }}
			{{ $.Scratch.Set "hasReplies" 0 }}
			<div class="post-comment-header">
			  <img class="post-comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=70">
			  <p class="post-comment-info"><strong>{{ .name }}</strong><br><small>{{ dateFormat "Monday, Jan 2, 2006" .date }}</small></p>
			</div>
			<div class="post-comment">
			  {{ .body | markdownify }}
			</div>
			<div class="post-comment-reply-button">
			  <a id="{{ ._id }}" class="btn-info" href="#comment-form" onclick="changeValue('fields[reply_to]', '{{ ._id }}')">Reageer op {{ .name }}</a>
			</div>
			<div style="clear: both;"></div>
			{{ range $comments }}
			  {{ if eq .reply_to ( $.Scratch.Get "parentId" ) }}
				{{ $.Scratch.Add "hasReplies" 1 }}
				  <div class="post-comment-header">
					<img class="post-comment-avatar-reply" src="https://www.gravatar.com/avatar/{{ .email }}?s=70">
					<p class="post-comment-info"><strong>{{ .name }}</strong><br><i><small>Reactie op {{ ( $.Scratch.Get "parentName" ) }}</i><br>{{ dateFormat "Monday, Jan 2, 2006" .date }}</small></p>
				  </div>
				  <div class="post-comment-reply">
					{{ .body | markdownify }}
				  </div>
			  {{ end }}
			{{ end }}
			{{ if gt ($.Scratch.Get "hasReplies") 0 }}
			  <div class="post-comment-reply-button-reply">
				<a id="{{ ._id }}" class="btn-info" href="#comment-form" onclick="changeValue('fields[reply_to]', '{{ ._id }}')">Reageer hierop</a>
			  </div>
			  <div style="clear: both;"></div>
			{{ end }}
		  {{ end }}
		{{ end }}
	  {{ end }}

	  {{ partial "comments/form" . }}
{{ end }}
</section>
